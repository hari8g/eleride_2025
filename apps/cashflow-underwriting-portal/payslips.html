<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payslips – Cashflow Underwriting Engine</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <img class="brand-logo" src="assets/eleride-logo.png" alt="eleRide" />
        <div>
          <div class="title">Cashflow Underwriting Engine</div>
          <div class="subtitle">Payslips (load weekly XLSX → render per rider → download PDF)</div>
        </div>
      </div>
      <nav class="nav">
        <a class="nav-link" href="index.html">Dashboard</a>
        <a class="nav-link" href="scenarios.html">Scenarios</a>
        <a class="nav-link active" href="payslips.html">Payslips</a>
      </nav>
      <div class="meta">
        <div id="statusPill" class="pill">Ready</div>
        <button id="reloadBtn" class="btn">Reload</button>
      </div>
    </header>

    <main class="container">
      <div id="loadingIndicator" style="padding: 40px; text-align: center;">
        <h2>Loading payslips...</h2>
        <p>Connecting to API...</p>
      </div>
      
      <div id="errorContainer" style="display: none; padding: 20px; margin: 20px; background: #fee; border: 2px solid #f00; border-radius: 8px;">
        <h2>Error Loading Page</h2>
        <div id="errorMessage"></div>
        <p style="margin-top: 10px;">Check browser console (F12) for details.</p>
      </div>
      
      <div id="mainContent" style="display: none;">
        <section class="panel">
          <div class="panel-head">
            <h2>Select file & rider</h2>
            <div class="muted">Loads from server `Data/` folder via API.</div>
          </div>
          <div class="filters" style="grid-template-columns: 2fr 2fr 1fr;">
            <div class="field">
              <label for="fileSel">Weekly payout file (.xlsx)</label>
              <select id="fileSel"></select>
            </div>
            <div class="field">
              <label for="riderSel">Rider</label>
              <select id="riderSel"></select>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button id="pdfBtn" class="btn">Download PDF</button>
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="panel-head">
            <h2>Payslip</h2>
            <div id="payslipMeta" class="muted"></div>
          </div>
          <div id="payslipView" class="doc"></div>
        </section>
      </div>
    </main>

    <script>
      // Immediate test - this should show immediately
      console.log("✅ HTML loaded, scripts starting...");
      document.addEventListener('DOMContentLoaded', function() {
        console.log("✅ DOM Content Loaded");
      });
      
      // Prevent SSL errors from cached scripts
      // Block any attempts to use api.eleride.co.in (which has SSL issues)
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
        const url = args[0];
        if (typeof url === 'string' && url.includes('api.eleride.co.in')) {
          console.warn('Blocked request to api.eleride.co.in (SSL issue):', url);
          return Promise.reject(new Error('SSL error: api.eleride.co.in not available. Use CloudFront domain.'));
        }
        return originalFetch.apply(this, args);
      };
    </script>
    <script src="payslips.js?v=3"></script>
    <script>
      // Verify payslips.js loaded
      console.log("✅ All scripts loaded");
    </script>
  </body>
</html>


